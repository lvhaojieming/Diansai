#include "AD9834.h" 
 
/**************************************************************** 
** 函数名称 ：AD9834_Write_16Bits
** 函数功能 ：向AD9834写入16位数据
** 输入参数 ：data --  要写入的16位数据
** 输出参数 ：无
** 返回说明 ：无
*****************************************************************/ 
void AD9834_Write_16Bits(uint32_t data) 
{ 
    uint8_t i = 0 ; 
 
    AD9834_SCLK_SET ; 
    AD9834_FSYNC_CLR ; 
 
    for(i=0; i<16; i++)      
		{ 
        if(data & 0x8000) 
          AD9834_SDATA_SET ; 
        else 
          AD9834_SDATA_CLR ; 
 
        AD9834_SCLK_CLR;
        data <<= 1 ; 
        AD9834_SCLK_SET ; 
    } 
 
    AD9834_SDATA_SET;
    AD9834_FSYNC_SET;
}  
 
/**************************************************************** 
** 函数名称 ：AD9834_Init
** 函数功能 ：初始化AD9834配置
** 输入参数 ：无
** 输出参数 ：无
** 返回说明 ：无
*****************************************************************/ 
void AD9834_Init(void) 
{
	
	HAL_GPIO_WritePin(GPIOA, AD9834_PS, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(GPIOA, AD9834_FS, GPIO_PIN_RESET);
	
	AD9834_Write_16Bits(0x2100);
	AD9834_Write_16Bits(0x2038);
	AD9834_Write_16Bits(0XC000);
	AD9834_Write_16Bits(0x2100);
	
}
 
/**************************************************************** 
** 函数名称 ：AD9834_SetFrequency
** 函数功能 ：设置频率值
** 输入参数 ：reg -- 要写入的频率寄存器(FREQ_REG_0、FREQ_REG_1) 
              fre -- 频率值              范围：（0Hz~268435455Hz）
              type -- 控制波形和输出方式  类型：（正弦波、三角波、方波）输出方式：（管脚控制还是寄存器控制）
** 输出参数 ：无
** 返回说明 ：寄存器的"PIN/SW"位为1时，使用相应的管脚控制频率寄存器
              寄存器的"PIN/SW"位为0时，使用相应的控制位控制频率寄存器
*****************************************************************/ 
void AD9834_SetFrequency(uint16_t reg, float fre, uint16_t type)
{
 
	uint16_t freqHi = reg;
	uint16_t freqLo = reg;
 
	unsigned long val = (268435456.0/AD9834_SYSTEM_COLCK)*fre;
	freqHi |= ((val & 0xFFFC000) >> 14);
	freqLo |= ((val & 0x3FFF));
 
	AD9834_Write_16Bits(type);
	AD9834_Write_16Bits(freqLo);
	AD9834_Write_16Bits(freqHi);
 
}
 
/*********************************************************************************************************
** 函数名称 ：AD9834_SetPhase
** 函数功能 ：设置相位
** 输入参数 ：reg--要写入的寄存器(PHASE_REG_0、PHASE_REG_1)
              val--相位值						范围：(0~4095对应0度~360度)
** 输出参数 ：无
** 返回说明 ：寄存器的"PIN/SW"位为1时，使用相应的管脚控制来控制相位寄存器
              寄存器的"PIN/SW"位为0时，使用相应的控制位控制相位寄存器
*********************************************************************************************************/
void AD9834_SetPhase(uint16_t reg, uint16_t val)
{
	uint16_t phase = reg|val;
	AD9834_Write_16Bits(phase);
}

/**************************************************************** 
** 函数名称 ：AD9834_Reset
** 函数功能 ：重置AD9834芯片
** 输入参数 ：无
** 输出参数 ：无
** 返回说明 ：无
*****************************************************************/
void AD9834_Reset(void)
{
    // 控制寄存器设置RESET位(D8)
    AD9834_Write_16Bits(0x2100); // 设置RESET位
    HAL_Delay(1);                // 短暂延时
    AD9834_Write_16Bits(0x2000); // 清除RESET位
}

/**************************************************************** 
** 函数名称 ：AD9834_EnableOutput
** 函数功能 ：使能AD9834输出
** 输入参数 ：无
** 输出参数 ：无
** 返回说明 ：无
*****************************************************************/
void AD9834_EnableOutput(void)
{
    // 清除控制寄存器的RESET位(D8)，使能输出
    AD9834_Write_16Bits(0x2000);
}
 

